<% instance = locals[:f].object %>
<%= locals[:f].input locals[:field], as: :attachment, direct: true, label: false, input_html: {style: 'display: none;'} %>
<div class="form-group">
  <label class="col-xs-12 col-sm-3 control-label" for="">Files</label>
  <div class="col-sm-9">
    <div class="upload-dropzone dropzone dz-clickable" data-upload-field="images" id="dropzoneUser">
      <div class="dz-default dz-message">
        <div class="col-xs-12">
          <h3><i class="fa fa-caret-right text-danger"></i> Drop files to upload.
            <span class="small"> (Or Click)</span>
          </h3>
        </div>
      </div>
    </div>
  </div>
</div>
<% if instance.send(locals[:field]) %>
    <%= locals[:f].input "remove_#{locals[:field]}".to_sym, as: :boolean, wrapper: :clean, input_html: {style: 'display: none;'} %>
    <script type="text/javascript">
        dropzone_edit('<%= instance.send("#{locals[:field]}_filename".to_sym) %>',
                <%= instance.send("#{locals[:field]}_size".to_sym) %>,
                '<%= instance.send("#{locals[:field]}_content_type".to_sym) %>',
                '<%= "#{instance.class.name.underscore}[remove_#{locals[:field]}]" %>',
                '<%= attachment_url(instance, locals[:field], :fill, 100, 100) %>');
                function dropzone_edit(file_filename, file_size, file_content_type, hidden_name, attachment_url) {
                	//$('input[name="user[avatar]"]').removeAttr('value');
                     Dropzone.options.dropzoneUser = {
                			 		maxFiles: 1,
                         init: function (file, done) {
                             thisDropzone = this;
                             var mockFile = {};
                             var indexVar = 0;
                             mockFile = {
                                 name: file_filename,
                                 size: file_size,
                                 type: file_content_type,
                                 hidden_name: hidden_name,
                                 index: indexVar
                             };
                             thisDropzone.options.addedfile.call(thisDropzone, mockFile);
                             thisDropzone.options.thumbnail.call(thisDropzone, mockFile, attachment_url);
                             noImage(mockFile);
                             $('#dropzoneUser').removeClass('dz-started');
                             $('.dz-image').children().before('<i class="fileUploadedCheck fa fa-2x fa-check-circle"></i>');
                             $('.dz-progress').fadeOut();
                         },
                         accept: function (file, done) {
                             back_files_news(file, done);
                         }
                     }
                 };
    </script>
<% else %>
  <script type="text/javascript">
    Dropzone.options.dropzoneUser = {
      maxFiles: 1
    };
  </script>
<% end %>
